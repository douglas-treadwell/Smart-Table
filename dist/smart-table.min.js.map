{"version":3,"sources":["smart-table.min.js"],"names":["ng","undefined","module","run","$templateCache","put","constant","pagination","template","itemsByPage","displayedPages","search","delay","inputEvent","select","mode","selectedClass","sort","ascentClass","descentClass","descendingFirst","skipNatural","pipe","controller","$scope","$parse","$filter","$attrs","copyRefs","src","concat","updateSafeCopy","safeCopy","safeGetter","pipeAfterSafeCopy","ctrl","deepDelete","object","path","indexOf","partials","split","key","pop","parentPath","join","parentObject","Object","keys","length","hashCode","string","i","chr","len","hash","charCodeAt","filtered","lastSelected","propertyName","stTable","displayGetter","displaySetter","assign","orderBy","filter","tableState","start","totalItemCount","this","stSafeSrc","$watch","safeSrc","newValue","oldValue","sortBy","predicate","reverse","keepPage","isFunction","functionName","name","functionHash","toString","input","predicateObject","prop","isString","trim","output","number","numberOfPages","Math","ceil","slice","parseInt","row","rows","index","isSelected","getFilteredCollection","setFilterFunction","filterName","setSortFunction","sortFunctionName","preventPipeOnWatch","directive","restrict","link","scope","element","attr","stSetFilter","stSetSort","stConfig","$timeout","require","tableCtrl","promise","throttle","stDelay","event","stInputEvent","$observe","value","predicateExpression","stSearch","bind","evt","originalEvent","cancel","target","stSelectMode","$apply","addClass","removeClass","defaultSort","func","getter","isArray","stSort","sortDefault","classAscent","stClassAscent","classDescent","stClassDescent","stateClasses","stSkipNatural","stDescendingFirst","stSortDefault","$eval","stItemsByPage","stDisplayedPages","stPageChange","templateUrl","attrs","stTemplate","redraw","end","paginationState","prevPage","currentPage","floor","max","abs","pages","numPages","push","newPage","selectPage","page","config","stPipe","pre","pipePromise","post","stTableService","id","register","$on","deregister","factory","$q","idCtrlMap","waiting","hasOwnProperty","resolve","get","waitFor","timeout","deferred","defer","reject","registeredController","angular"],"mappings":"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","file":"smart-table.min.js","sourcesContent":["(function (ng, undefined){\n    'use strict';\n\nng.module('smart-table', []).run(['$templateCache', function ($templateCache) {\n    $templateCache.put('template/smart-table/pagination.html',\n        '<nav ng-if=\"numPages && pages.length >= 2\"><ul class=\"pagination\">' +\n        '<li ng-repeat=\"page in pages\" ng-class=\"{active: page==currentPage}\"><a ng-click=\"selectPage(page)\">{{page}}</a></li>' +\n        '</ul></nav>');\n}]);\n\n\nng.module('smart-table')\n  .constant('stConfig', {\n    pagination: {\n      template: 'template/smart-table/pagination.html',\n      itemsByPage: 10,\n      displayedPages: 5\n    },\n    search: {\n      delay: 400, // ms\n      inputEvent: 'input'\n    },\n    select: {\n      mode: 'single',\n      selectedClass: 'st-selected'\n    },\n    sort: {\n      ascentClass: 'st-sort-ascent',\n      descentClass: 'st-sort-descent',\n      descendingFirst: false,\n      skipNatural: false,\n      delay:300\n    },\n    pipe: {\n      delay: 100 //ms\n    }\n  });\nng.module('smart-table')\n  .controller('stTableController', ['$scope', '$parse', '$filter', '$attrs', function StTableController ($scope, $parse, $filter, $attrs) {\n    var propertyName = $attrs.stTable;\n    var displayGetter = $parse(propertyName);\n    var displaySetter = displayGetter.assign;\n    var safeGetter;\n    var orderBy = $filter('orderBy');\n    var filter = $filter('filter');\n    var safeCopy = copyRefs(displayGetter($scope));\n    var tableState = {\n      sort: {},\n      search: {},\n      pagination: {\n        start: 0,\n        totalItemCount: 0\n      }\n    };\n    var filtered;\n    var pipeAfterSafeCopy = true;\n    var ctrl = this;\n    var lastSelected;\n\n    function copyRefs (src) {\n      return src ? [].concat(src) : [];\n    }\n\n    function updateSafeCopy () {\n      safeCopy = copyRefs(safeGetter($scope));\n      if (pipeAfterSafeCopy === true) {\n        ctrl.pipe();\n      }\n    }\n\n    function deepDelete (object, path) {\n      if (path.indexOf('.') != -1) {\n        var partials = path.split('.');\n        var key = partials.pop();\n        var parentPath = partials.join('.');\n        var parentObject = $parse(parentPath)(object)\n        delete parentObject[key];\n        if (Object.keys(parentObject).length == 0) {\n          deepDelete(object, parentPath);\n        }\n      } else {\n        delete object[path];\n      }\n    }\n\n    if ($attrs.stSafeSrc) {\n      safeGetter = $parse($attrs.stSafeSrc);\n      $scope.$watch(function () {\n        var safeSrc = safeGetter($scope);\n        return safeSrc && safeSrc.length ? safeSrc[0] : undefined;\n      }, function (newValue, oldValue) {\n        if (newValue !== oldValue) {\n          updateSafeCopy();\n        }\n      });\n      $scope.$watch(function () {\n        var safeSrc = safeGetter($scope);\n        return safeSrc ? safeSrc.length : 0;\n      }, function (newValue, oldValue) {\n        if (newValue !== safeCopy.length) {\n          updateSafeCopy();\n        }\n      });\n      $scope.$watch(function () {\n        return safeGetter($scope);\n      }, function (newValue, oldValue) {\n        if (newValue !== oldValue) {\n          tableState.pagination.start = 0;\n          updateSafeCopy();\n        }\n      });\n    }\n\n    function hashCode(string) { // modified from http://stackoverflow.com/questions/7616461/generate-a-hash-from-string-in-javascript-jquery\n      var hash = 0, i, chr, len;\n\n      if (!string || string.length === 0) {\n        return hash;\n      }\n\n      for (i = 0, len = string.length; i < len; i++) {\n        chr   = string.charCodeAt(i);\n        hash  = ((hash << 5) - hash) + chr;\n        hash |= 0; // Convert to 32bit integer\n      }\n\n      return hash;\n    }\n\n    /**\n     * sort the rows\n     * @param {Function | String} predicate - function or string which will be used as predicate for the sorting\n     * @param [reverse] - if you want to reverse the order\n     */\n    this.sortBy = function sortBy (predicate, reverse, keepPage) {\n      tableState.sort.predicate = predicate;\n      tableState.sort.reverse = reverse === true;\n\n      if (ng.isFunction(predicate)) {\n        tableState.sort.functionName = predicate.name;\n\n        if ( !predicate.name ) { // the $watch on .sort in stSort.js will not fire if only the .sort.predicate function changes\n          tableState.sort.functionHash = hashCode(predicate.toString()); // a non-function property must change\n        }\n      } else {\n        delete tableState.sort.functionName;\n        delete tableState.sort.functionHash;\n      }\n\n      if ( !keepPage ) {\n        tableState.pagination.start = 0;\n      }\n\n      return this.pipe();\n    };\n\n    /**\n     * search matching rows\n     * @param {String} input - the input string\n     * @param {String} [predicate] - the property name against you want to check the match, otherwise it will search on all properties\n     */\n    this.search = function search (input, predicate) {\n      var predicateObject = tableState.search.predicateObject || {};\n      var prop = predicate ? predicate : '$';\n\n      input = ng.isString(input) ? input.trim() : input;\n      $parse(prop).assign(predicateObject, input);\n      // to avoid to filter out null value\n      if (!input) {\n        deepDelete(predicateObject, prop);\n      }\n      tableState.search.predicateObject = predicateObject;\n      tableState.pagination.start = 0;\n      return this.pipe();\n    };\n\n    /**\n     * this will chain the operations of sorting and filtering based on the current table state (sort options, filtering, ect)\n     */\n    this.pipe = function pipe () {\n      var pagination = tableState.pagination;\n      var output;\n      filtered = tableState.search.predicateObject ? filter(safeCopy, tableState.search.predicateObject) : safeCopy;\n      if (tableState.sort.predicate) {\n        filtered = orderBy(filtered, tableState.sort.predicate, tableState.sort.reverse);\n      }\n      pagination.totalItemCount = filtered.length;\n      if (pagination.number !== undefined) {\n        pagination.numberOfPages = filtered.length > 0 ? Math.ceil(filtered.length / pagination.number) : 1;\n        pagination.start = pagination.start >= filtered.length ? (pagination.numberOfPages - 1) * pagination.number : pagination.start;\n        output = filtered.slice(pagination.start, pagination.start + parseInt(pagination.number));\n      }\n      displaySetter($scope, output || filtered);\n    };\n\n    /**\n     * select a dataRow (it will add the attribute isSelected to the row object)\n     * @param {Object} row - the row to select\n     * @param {String} [mode] - \"single\" or \"multiple\" (multiple by default)\n     */\n    this.select = function select (row, mode) {\n      var rows = copyRefs(displayGetter($scope));\n      var index = rows.indexOf(row);\n      if (index !== -1) {\n        if (mode === 'single') {\n          row.isSelected = row.isSelected !== true;\n          if (lastSelected) {\n            lastSelected.isSelected = false;\n          }\n          lastSelected = row.isSelected === true ? row : undefined;\n        } else {\n          rows[index].isSelected = !rows[index].isSelected;\n        }\n      }\n    };\n\n    /**\n     * take a slice of the current sorted/filtered collection (pagination)\n     *\n     * @param {Number} start - start index of the slice\n     * @param {Number} number - the number of item in the slice\n     */\n    this.slice = function splice (start, number) {\n      tableState.pagination.start = start;\n      tableState.pagination.number = number;\n      return this.pipe();\n    };\n\n    /**\n     * return the current state of the table\n     * @returns {{sort: {}, search: {}, pagination: {start: number}}}\n     */\n    this.tableState = function getTableState () {\n      return tableState;\n    };\n\n    this.getFilteredCollection = function getFilteredCollection () {\n      return filtered || safeCopy;\n    };\n\n    /**\n     * Use a different filter function than the angular FilterFilter\n     * @param filterName the name under which the custom filter is registered\n     */\n    this.setFilterFunction = function setFilterFunction (filterName) {\n      filter = $filter(filterName);\n    };\n\n    /**\n     * Use a different function than the angular orderBy\n     * @param sortFunctionName the name under which the custom order function is registered\n     */\n    this.setSortFunction = function setSortFunction (sortFunctionName) {\n      orderBy = $filter(sortFunctionName);\n    };\n\n    /**\n     * Usually when the safe copy is updated the pipe function is called.\n     * Calling this method will prevent it, which is something required when using a custom pipe function\n     */\n    this.preventPipeOnWatch = function preventPipe () {\n      pipeAfterSafeCopy = false;\n    };\n  }])\n  .directive('stTable', function () {\n    return {\n      restrict: 'A',\n      controller: 'stTableController',\n      link: function (scope, element, attr, ctrl) {\n\n        if (attr.stSetFilter) {\n          ctrl.setFilterFunction(attr.stSetFilter);\n        }\n\n        if (attr.stSetSort) {\n          ctrl.setSortFunction(attr.stSetSort);\n        }\n      }\n    };\n  });\n\nng.module('smart-table')\n  .directive('stSearch', ['stConfig', '$timeout','$parse', function (stConfig, $timeout, $parse) {\n    return {\n      require: '^stTable',\n      link: function (scope, element, attr, ctrl) {\n        var tableCtrl = ctrl;\n        var promise = null;\n        var throttle = attr.stDelay || stConfig.search.delay;\n        var event = attr.stInputEvent || stConfig.search.inputEvent;\n\n        attr.$observe('stSearch', function (newValue, oldValue) {\n          var input = element[0].value;\n          if (newValue !== oldValue && input) {\n            ctrl.tableState().search = {};\n            tableCtrl.search(input, newValue);\n          }\n        });\n\n        //table state -> view\n        scope.$watch(function () {\n          return ctrl.tableState().search;\n        }, function (newValue, oldValue) {\n          var predicateExpression = attr.stSearch || '$';\n          if (newValue.predicateObject && $parse(predicateExpression)(newValue.predicateObject) !== element[0].value) {\n            element[0].value = $parse(predicateExpression)(newValue.predicateObject) || '';\n          }\n        }, true);\n\n        // view -> table state\n        element.bind(event, function (evt) {\n          evt = evt.originalEvent || evt;\n          if (promise !== null) {\n            $timeout.cancel(promise);\n          }\n\n          promise = $timeout(function () {\n            tableCtrl.search(evt.target.value, attr.stSearch || '');\n            promise = null;\n          }, throttle);\n        });\n      }\n    };\n  }]);\n\nng.module('smart-table')\n  .directive('stSelectRow', ['stConfig', function (stConfig) {\n    return {\n      restrict: 'A',\n      require: '^stTable',\n      scope: {\n        row: '=stSelectRow'\n      },\n      link: function (scope, element, attr, ctrl) {\n        var mode = attr.stSelectMode || stConfig.select.mode;\n        element.bind('click', function () {\n          scope.$apply(function () {\n            ctrl.select(scope.row, mode);\n          });\n        });\n\n        scope.$watch('row.isSelected', function (newValue) {\n          if (newValue === true) {\n            element.addClass(stConfig.select.selectedClass);\n          } else {\n            element.removeClass(stConfig.select.selectedClass);\n          }\n        });\n      }\n    };\n  }]);\n\nng.module('smart-table')\n\t.directive('stSort', ['stConfig', '$parse', '$timeout', function (stConfig, $parse, $timeout) {\n\t\treturn {\n\t\t\trestrict: 'A',\n\t\t\trequire: '^stTable',\n\t\t\tlink: function (scope, element, attr, ctrl) {\n\n\t\t\t\tvar predicate = attr.stSort;\n\t\t\t\tvar getter = $parse(predicate);\n\t\t\t\tvar index = 0;\n\t\t\t\tvar classAscent = attr.stClassAscent || stConfig.sort.ascentClass;\n\t\t\t\tvar classDescent = attr.stClassDescent || stConfig.sort.descentClass;\n\t\t\t\tvar stateClasses = [classAscent, classDescent];\n\t\t\t\tvar sortDefault;\n\t\t\t\tvar skipNatural = attr.stSkipNatural !== undefined ? attr.stSkipNatural : stConfig.sort.skipNatural;\n\t\t\t\tvar descendingFirst = attr.stDescendingFirst !== undefined ? attr.stDescendingFirst : stConfig.sort.descendingFirst;\n\t\t\t\tvar promise = null;\n\t\t\t\tvar throttle = attr.stDelay || stConfig.sort.delay;\n\n\t\t\t\tif (attr.stSortDefault) {\n\t\t\t\t\tsortDefault = scope.$eval(attr.stSortDefault) !== undefined ? scope.$eval(attr.stSortDefault) : attr.stSortDefault;\n\t\t\t\t}\n\n\t\t\t\t//view --> table state\n\t\t\t\tfunction sort (defaultSort) {\n\t\t\t\t\tif ( descendingFirst ) {\n\t\t\t\t\t\tif ( index === 0 ) {\n\t\t\t\t\t\t\tindex = 2;\n\t\t\t\t\t\t} else if ( index === 2 ) {\n\t\t\t\t\t\t\tindex = 1;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tindex = 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tindex++;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar func;\n\t\t\t\t\tpredicate = ng.isFunction(getter(scope)) || ng.isArray(getter(scope)) ? getter(scope) : attr.stSort;\n\t\t\t\t\tif (index % 3 === 0 && !!skipNatural !== true) {\n\t\t\t\t\t\t//manual reset\n\t\t\t\t\t\tindex = 0;\n\t\t\t\t\t\tctrl.tableState().sort = {};\n\t\t\t\t\t\tctrl.tableState().pagination.start = 0;\n\t\t\t\t\t\tfunc = ctrl.pipe.bind(ctrl);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfunc = ctrl.sortBy.bind(ctrl, predicate, index % 2 === 0, defaultSort /* keeps current page if true */);\n\t\t\t\t\t}\n\t\t\t\t\tif (promise !== null) {\n\t\t\t\t\t\t$timeout.cancel(promise);\n\t\t\t\t\t}\n\t\t\t\t\tif (throttle < 0) {\n\t\t\t\t\t\tfunc();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpromise = $timeout(func, throttle);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\telement.bind('click', function sortClick () {\n\t\t\t\t\tif (predicate) {\n\t\t\t\t\t\tscope.$apply(function() { // $apply passes $scope to the called function\n\t\t\t\t\t\t\tsort(); // avoid passing this to sort(); could also use .bind but this is trivial\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (sortDefault) {\n\t\t\t\t\tindex = sortDefault === 'reverse' ? 1 : 0;\n\t\t\t\t\tsort(true);\n\t\t\t\t}\n\n\t\t\t\t//table state --> view\n\t\t\t\tscope.$watch(function () {\n\t\t\t\t\treturn ctrl.tableState().sort;\n\t\t\t\t}, function (newValue) {\n\t\t\t\t\tif (newValue.predicate !== predicate) {\n\t\t\t\t\t\tindex = 0;\n\t\t\t\t\t\telement\n\t\t\t\t\t\t\t.removeClass(classAscent)\n\t\t\t\t\t\t\t.removeClass(classDescent);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tindex = newValue.reverse === true ? 2 : 1;\n\t\t\t\t\t\telement\n\t\t\t\t\t\t\t.removeClass(stateClasses[index % 2])\n\t\t\t\t\t\t\t.addClass(stateClasses[index - 1]);\n\t\t\t\t\t}\n\t\t\t\t}, true);\n\t\t\t}\n\t\t};\n\t}]);\n\nng.module('smart-table')\n  .directive('stPagination', ['stConfig', function (stConfig) {\n    return {\n      restrict: 'EA',\n      require: '^stTable',\n      scope: {\n        stItemsByPage: '=?',\n        stDisplayedPages: '=?',\n        stPageChange: '&'\n      },\n      templateUrl: function (element, attrs) {\n        if (attrs.stTemplate) {\n          return attrs.stTemplate;\n        }\n        return stConfig.pagination.template;\n      },\n      link: function (scope, element, attrs, ctrl) {\n\n        scope.stItemsByPage = scope.stItemsByPage ? +(scope.stItemsByPage) : stConfig.pagination.itemsByPage;\n        scope.stDisplayedPages = scope.stDisplayedPages ? +(scope.stDisplayedPages) : stConfig.pagination.displayedPages;\n\n        scope.currentPage = 1;\n        scope.pages = [];\n\n        function redraw () {\n          var paginationState = ctrl.tableState().pagination;\n          var start = 1;\n          var end;\n          var i;\n          var prevPage = scope.currentPage;\n          scope.totalItemCount = paginationState.totalItemCount;\n          scope.currentPage = Math.floor(paginationState.start / paginationState.number) + 1;\n\n          start = Math.max(start, scope.currentPage - Math.abs(Math.floor(scope.stDisplayedPages / 2)));\n          end = start + scope.stDisplayedPages;\n\n          if (end > paginationState.numberOfPages) {\n            end = paginationState.numberOfPages + 1;\n            start = Math.max(1, end - scope.stDisplayedPages);\n          }\n\n          scope.pages = [];\n          scope.numPages = paginationState.numberOfPages;\n\n          for (i = start; i < end; i++) {\n            scope.pages.push(i);\n          }\n\n          if (prevPage !== scope.currentPage) {\n            scope.stPageChange({newPage: scope.currentPage});\n          }\n        }\n\n        //table state --> view\n        scope.$watch(function () {\n          return ctrl.tableState().pagination;\n        }, redraw, true);\n\n        //scope --> table state  (--> view)\n        scope.$watch('stItemsByPage', function (newValue, oldValue) {\n          if (newValue !== oldValue) {\n            scope.selectPage(1);\n          }\n        });\n\n        scope.$watch('stDisplayedPages', redraw);\n\n        //view -> table state\n        scope.selectPage = function (page) {\n          if (page > 0 && page <= scope.numPages) {\n            ctrl.slice((page - 1) * scope.stItemsByPage, scope.stItemsByPage);\n          }\n        };\n\n        if (!ctrl.tableState().pagination.number) {\n          ctrl.slice(0, scope.stItemsByPage);\n        }\n      }\n    };\n  }]);\n\nng.module('smart-table')\n  .directive('stPipe', ['stConfig', '$timeout', function (config, $timeout) {\n    return {\n      require: 'stTable',\n      scope: {\n        stPipe: '='\n      },\n      link: {\n\n        pre: function (scope, element, attrs, ctrl) {\n\n          var pipePromise = null;\n\n          if (ng.isFunction(scope.stPipe)) {\n            ctrl.preventPipeOnWatch();\n            ctrl.pipe = function () {\n\n              if (pipePromise !== null) {\n                $timeout.cancel(pipePromise)\n              }\n\n              pipePromise = $timeout(function () {\n                scope.stPipe(ctrl.tableState(), ctrl);\n              }, config.pipe.delay);\n\n              return pipePromise;\n            }\n          }\n        },\n\n        post: function (scope, element, attrs, ctrl) {\n          ctrl.pipe();\n        }\n      }\n    };\n  }]);\n\nng.module('smart-table')\n  .directive('stTableId', ['stTableService', function (stTableService) {\n    return {\n      require: '^stTable',\n      scope: {\n        id: '@stTableId'\n      },\n      link: function (scope, element, attrs, ctrl) {\n        stTableService.register(scope.id, ctrl);\n\n        scope.$on('$destroy', function() {\n          stTableService.deregister(scope.id);\n        });\n      }\n    };\n  }]);\n\nng.module('smart-table')\n  .factory('stTableService', ['$q', '$timeout', function ($q, $timeout) {\n    var idCtrlMap = { };\n    var waiting   = { };\n\n    return {\n      register: function(id, ctrl) {\n        idCtrlMap[id] = ctrl;\n\n        if ( waiting[id] ) {\n          for ( var index in waiting[id] ) {\n            if ( waiting[id].hasOwnProperty(index) ) {\n              waiting[id][index].resolve(ctrl);\n            }\n          }\n\n          delete waiting[id];\n        }\n      },\n\n      deregister: function(id) {\n        delete idCtrlMap[id];\n      },\n\n      get: function(id) {\n        return idCtrlMap[id];\n      },\n\n      waitFor: function(id, timeout) {\n        var deferred = $q.defer();\n\n        if ( timeout !== undefined ) {\n          $timeout(function() {\n            deferred.reject('Timed out waiting for StTableController ' + id);\n          }, timeout);\n        }\n\n        var registeredController = this.get(id);\n\n        if ( registeredController ) {\n          deferred.resolve(registeredController);\n        } else if ( waiting[id] ) {\n          waiting[id].push(deferred);\n        } else {\n          waiting[id] = [deferred];\n        }\n\n        return deferred.promise;\n      }\n    };\n  }]);\n\n})(angular);"],"sourceRoot":"/source/"}